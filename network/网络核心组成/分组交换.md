### 报文
- message
- 由协议设计者定义
- 可以包含控制和数据字节

### 分组
- packet
- 源将长的[[#报文]]划分为较小的数据块

### 分组交换机
- 源和目的地之间，分组通过通信链路和分组交换机传送
- 分为两类
	1. 路由器（router）
	2. 链路层交换机（link-layer switch）

### 链路传输速率
- 以该链路最大传输速率的速度传输
- 假设为$R$ $bit/s$
	
### 单条链路传播时间
- 发送一个$L$个$bit$的分组，[[#链路传输速率]]为$R$ $bit/s$，则传输该分组的时间为$L/R$ $s$

### 存储转发传输
- store-and-forward transmission
- 指[[#分组交换机]]在开始向链路传输该[[#分组]]的第一个bit之前，必须接收到整个分组
- 源——>路由器—>目的地
- 过程：源传输了分组1的一部分，即分组1的一部分已经到达路由器，由于路由器应用了存储转发机制，所以现在还不能传输已经接收到的分组1的数据给目的地，必须等到分组1整个接收存储完成（即缓存），才可以向目的地发送分组（转发）
- 计算整个过程所经过的时间（忽略传播时延，bit以光速跨越线路所需要的时间（？））
	1. 源发送1个$L$$bit$的分组（称为分组1），2条链路，1个路由器
	设[[#链路传输速率]]为$R$ $bit/s$，时间流逝为$t$
	则：
		$t=0$ 时，源开始传输一个$L$个$bit$的分组1
		$t=L/R$ $s$时，源传输完分组1的所有bit，路由器接收到完整的分组1，并开始转发分组1。（即存储转发）
		$t=2L/R$ $s$时，路由器传输完分组1的所有bit，目的地接收到完整的分组1
	整个过程耗时$2L/R$ $s$
	
	若没有存储转发机制，即路由器接收到就转发，则整个过程耗时为[[#单条链路传播时间]]，$L/R$ $s$
	
	2. 源发送3个$L$$bit$的分组（分别称为分组1，分组2，分组3），2条链路，1个路由器
		设[[#链路传输速率]]为$R$ $bit/s$，时间流逝为$t$
		则：
			$t=0$ 时，源开始传输第1个$L$个$bit$的分组1
			$t=L/R$ $s$时，源传输完分组1的所有bit并开始发送分组2，路由器接收到完整的分组1，并开始转发分组1（即存储转发）。
			$t=2L/R$ $s$时，源传输完分组2的所有bit并开始发送分组3，路由器接收到完整的分组2，并开始转发分组2（即存储转发）。目的地接收到完整的分组1。
			$t=3L/R$ $s$时，源传输完分组3的所有bit，路由器接收到完整的分组3，并开始转发分组3（即存储转发）。目的地接收到完整的分组2。
			$t=4L/R$ $s$时，路由器传输完分组3的所有bit，目的地接收到完整的分组3
		整个过程耗时$4L/R$ $s$
	3. 源发送$P$个$L$$bit$的分组），2条链路，1个路由器
		整个过程耗时：$d_{端到端} ={(p+(2-1))}\cdot \dfrac{L}{R}$
	4. 源发送1个$L$$bit$的分组（称为分组1），$n$条链路，$n-1$个路由器
		整个过程耗时：$d_{端到端} = n\dfrac{L}{R}$
	5. 源发送$P$个$L$$bit$的分组，$n$条链路，$n-1$个路由器
			$t=P\cdot L/R$ $s$时，源传输完$分组P$的所有bit，$路由器1$接收到完整的$分组P$
			$t=P\cdot L/R + L/R$ $s$时，$路由器1$传输完$分组P$的所有bit，$路由器2$接收到完整的$分组P$
			$t=P\cdot L/R + 2L/R$ $s$时，$路由器2$传输完$分组P$的所有bit，$路由器3$接收到完整的$分组P$
			$t=P\cdot L/R + (n-2)L/R$ $s$时，$路由器n-2$传输完$分组P$的所有bit，$路由器n-1$接收到完整的$分组P$
			$t=P\cdot L/R + (n-1)L/R$ $s$时，$路由器n-1$传输完$分组P$的所有bit，目的地接收到完整的$分组P$
		整个过程耗时：$d_{端到端} = (p+n-1)\dfrac{L}{R}$
		解释：源发送完$P$个$L$$bit$的分组，耗时$P\cdot L/R$ $s$，当源发送完成时，最后一个分组已经缓存在第一个路由器中，此时第一个路由器到目的地之间有$n-1$条链路，最后一个分组需要耗时$(n-1)\dfrac{L}{R}$ $s$才能到达目的地。所以整个过程耗时$(p+n-1)\dfrac{L}{R}$
		
### 输出缓存
- output buffer 或称输出队列output queue
- [[#分组交换机]]为每条与它相连的链路配有一个缓存，用于存储准备发往该链路的分组

### 排队时延
- queuing delay
- 除了[[#存储转发传输]]时延外，分组还要承受[[#排队时延]]
- 当分组到达路由器并想传输到某条链路中时，正有别的分组在传输，则到达的分组要在[[#输出缓存]]中等待。
- 时延是变化的，取决于网络拥塞程度
### 分组丢失
- packet less 即丢包
- [[#输出缓存]]的大小是有限的。分组到达时，缓存已被占满待传输的分组，这时到达的分组或已排队的分组之一将被丢弃
- 当分组到达路由器的到达率 > 出链路的传输速率就会发生拥塞


### 转发表
- forwarding table
- 每台路由器中都有
- 将目的地址或目的地址的一部分映射成输出链路
- 路由器上的转发表的配置，是由[[#路由选择协议]]自动设置的
### 路由选择协议
- routing protocal
- 自动设置[[#转发表]]
- 一些协议可以找到每台路由器到每个目的地最短路径结果，并将结果来配置[[#转发表]]
### 如何找到目的地
- 路由器中有多个输入链路和输出链路，那么分组到达时应该选择哪个输出链路呢
- 不同网络有不同方法，以internet为例
- 每个端系统有一个称为IP地址的地址
- 源想目的地发送分组时，该分组部首包含目的地的IP地址
- 分组到达路由器时，路由器检查目的地址的一部分，通过在[[#转发表]]中搜索该地址，找到适当输出链路传输分组，向一台相邻路由器发送
- 可以通过问路来类比，问一个大概的位置，到了那个地方再问当地的人