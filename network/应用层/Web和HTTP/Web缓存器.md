- **Web缓存器（Web cache）**，**代理缓存器（proxy cache）**，**代理服务器（proxy server）**
- 之所以叫代理服务器，是因为它可以代表**初始服务器**，处理HTTP请求的网络对象
- 也可以代表客户浏览器，向初始服务器发起HTTP请求，请求某个对象
- 通常由[[ISP]]购买并安装，如校园网、住宅ISP
### 组成
- Web缓存器中有磁盘存储，保存最近请求过的对象的**副本**
- 配置用户浏览器，使所有HTTP请求先指向Web缓存器，此时，所有HTTP请求将首先被定向到Web缓存器
- Web缓存器既是服务器又是客户
![[web缓存器组成.png]]

### 过程
浏览器配置后Web缓存器后，访问某一网站
1. 浏览器建立一个到Web缓存器的TCP连接，并发送一个HTTP请求某对象
2. Web缓存器检查本地是否存储该对象的副本，如果有，直接返回一个包括它的HTTP响应
3. 如果没有，则Web缓存器建立一个到**该对象所在的初始服务器**的TCP连接，发送一个HTTP请求该对象
4. 初始服务器收到请求后，发送该对象的HTTP响应，到Web缓存器
5. Web缓存器收到该对象后，在本地存储一份该副本，并通过之前与浏览器建立的TCP连接，发送该对象的HTTP响应报文，到浏览器

### 优点
- 部署Web缓存器的原因有两个
	1. 大大减少对客户请求的响应时间。
		一般，客户与Web缓存器的瓶颈带宽 >> 客户与初始服务器的瓶颈带宽
		当客户请求直接使用Web缓存器中的对象时，响应时间就很小了
	2. 大大减少一个机构接入到internet的通信量
		大部分请求对象都可以通过Web缓存器处理，少部分请求web缓存器中没有的对象才进入internet与初始服务器通信
		
### 优点的定量计算
##### 场景
- 机构网络：客户端系统通过高速局域网连接，100Mbps
- 公共internet：初始服务器在世界各地，通过公共internet连接
- 机构网络的一个路由器通过一条链路与公共internet的一个路由器连接，该链路传输速度：15Mbps
- 机构网络中的客户请求初始服务器中的对象，即访问
- 假设
	1. 对象的平均长度为1Mb
	2. 平均访问速率为15个请求/s
	3. HTTP请求[[internet协议栈#应用层|报文]]小到可以忽略，即不会产生什么通信量
	4. internet时延：公共internet一侧的路由器转发客户一个HTTP请求报文（通常在一个IP[[internet协议栈#网络层|数据报]]中），到，收到初始服务器的响应报文（通常在多个IP数据报中），的时延。平均为2s。
![[web缓存的一个场景.png]]

##### 总响应时间
- 从浏览器请求一个对象，到，接收到该对象的时间
- 局域网时延 + 接入时延（两台路由器之间的）+ internet时延（2s）
- 局域网的[[时延和丢包#流量强度|流量强度]]为：$(15个请求/s \cdot 1Mb/请求)/100Mbps = 0.15$
	所以局域网时延很小（10ms），可以忽略
- 接入链路的[[时延和丢包#流量强度|流量强度]]为：$(15个请求/s \cdot 1Mb/请求)/15Mbps = 1$
	所以接入时延趋于无穷
- 总响应时间趋于无穷

##### 解决方法1
- 增加接入链路速率
- 当接入链路速率升级到100Mbps，流量强度也为0.15，接入时延也可以忽略
- [[#总响应时间]]为2s
- 但升级链路带宽的代价很高

##### 解决方法2
- 安装Web缓存器
- 假设
	1. Web缓存器的命中（缓存器本地直接可以找到请求的对象）率为0.4。（实际中一般为0.2 - 0.7之间）
- 则
	1. 40%的请求直接由缓存器返回响应，时延10ms
	2. 60%的请求通过缓存器和接入链路，向初始服务器请求，流量降低为原来的60%，此时流量强度由1降低为0.6
	3. 一般，在15Mbps的链路上，流量强度为0.8以下，时延较小，约为几十ms，可以忽略
	4. $总响应时间 = 0.4 \cdot 0.010s + 0.6 \cdot 2.01s \approx 1.2s$
- 比[[#解决方法1]]的时延还要低
- 不需要机构升级接入internet网的链路，其他成本也较低
![[添加web缓存器.png]]

### CDN
- 内容分发网络（Content Distribution Network）
- Web缓存器的一种
- 将大量流量转移到缓存器中
- 分为多个共享CDN、专用CDN

### 问题
- Web缓存器本地存储的对象副本可能是陈旧的
- 解决方式是使用[[条件Get方法]]