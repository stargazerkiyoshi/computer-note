## 节点时延
分组从源到目的地经历不同类型的时延，重要的有：节点**[[#处理时延]]**、**[[#排队时延]]**、**[[#传输时延]]**和**[[#传播时延]]**，累加起来为**[[#节点总时延]]**

分组到达路由器A后所经历的一系列处理并选择出链路，处理期间存在[[#处理时延]]。然后将分组引入发送到出链路之前的缓存队列中，排队期间存在[[#排队时延]]。当排队轮到该分组时，开始传输它，传输期间存在[[#传输时延]]。传输结束后，分组在链路起点到终点的传播过程中存在[[#传播时延]]。分组被路由器B接收，并转发下去。

### 处理时延
- 即节点处理时延 nodal processing delay
- 分组到达路由器时所经历的一系列处理，并选择出链路所需要的时间。设为：$d_{proc}$
- 包括：
	1. 检查bit级别的差错
	2. 检查分组首部决定导向何处
- 微秒或更少的时间

### 排队时延
- queuing delay
- 分组在队列中等待传输到链路上的时间。设为：$d_{queue}$
- 取决于：
	1. 先期到达该队列，正在排队等待传输的分组数量，换一种说法是分组到达速率
	2. 链路传输速率
	3. 到达流量的性质。即是周期性到达，还是突发性
- 毫秒到微秒量级
- transmission dealy
- 分组开始传输到传输结束（发射）的时间。设为：$d_{trans}$
- 取决于
	1. 分组长度（设为$L$ $bit$）
	2. 链路传输速率（设为$R$ $b/s$）
	计算公式为：$L/R$
- 毫秒到微秒量级

### 传播时延
- propagation delay
- 分组的一个bit在链路起点到终点的传播时间。设为：$d_{prop}$
- 取决于：
	1. 链路传播速率（设为$s$）。取决于[[物理媒体]]。略小于光速。范围 $2 \times 10^8$ - $3\times10^8$ $m/s$
	2. 链路的距离（两台路由器之间）（设为$d$）
	计算公式为：$d/s$
- 广域网中，毫秒量级

### 类比
10辆汽车车队（分组）在高速公路（网络路径）中行驶，路过收费站（路由器），收费站全部放行完的时间即为[[#传输时延]]，是车队数量和放行速度的函数。某一辆车在两个收费站之间的公路（链路）上行驶的时间为[[#传播时延]]，收费站之间的距离和车速（传播速率）的函数

有时全部放行完的时间甚至可能大于汽车行驶在收费站之间的时间，也是可能的

### 节点总时延
- total nodal delay
- 计算公式：$d_{nodal}=d_{proc}+d_{queue}+d_{trans}+d_{prop}$
- 其中每个部分的大小可能有很大不同
    1. 卫星链路中：$d_{prop}$可能是几百毫秒
	2. 低速拨号调制解调器发送长分组：$d_{trans}$可能是数百毫秒
	3. 路由器在最大吞吐量时：$d_{proc}$有影响

### [[#排队时延]]的细节
- 流量强度推导
 **假设**：
	1. 分组到达队列的平均速率：$a$ $pkt/s$（分组/秒）
	2. 链路传输速率，即队列推出bit的速率：$R$ $bps$ （$b/s$）
	3. 每一个分组长度：$L$ $bit$
	4. 队列长度：$\infty$ $bit$
**则**：
  	1. bit 到达队列的速率为：$La$ $bps$
  	2. 入、出队列速率比为：$La / R$ 。称为**流量强度（traffic intensity）**
  	3. 若：${La / R} > 1$，队列长度趋于$\infty$，排队时延趋于$\infty$
		若：${La / R} \leq 1$
**结论**：
		流量工程设计系统时流量强度不能大于 1
- 到达流量的性质对排队时延的影响
**假设**
	1. 基础同上
	2. 考虑流量强度${La / R} \leq 1$
	则：
	1. 周期性到达
		每$L/R$秒到达一个分组，此时每当到达一个分组，队列总是空的，因为分组到达的间隔与路由器传输时延相等，所以排队时延为0
	2. 突发到达
		每$(L/R)N$秒到达N个分组，此时第一个分组传输排队时延为0（到达立刻传输），第二个分组等待第一个分组传输完毕，排队时延为$L/R$秒，则第$n$个分组排队时延为$(n-1)L/R$秒。
		平均排队时延为：$\frac{1}{n}\sum_{i=1}^n \frac{(n-1)L}{R}$
	3. 随机到达
		更真实的情况
		流量强度与平均排队时延的关系。越接近1，时延成指数型上升

### 丢包
- [[#排队时延 的细节]]中假设队列长度为：$\infty$，实际不可能。
- 流量强度 > 1时，路由器会**丢弃(drop)**该分组。
- 端系统看来是分组已经发送但在网络中丢失
- 端系统可能将丢失的分组重传
- 时延和丢包率是衡量网络的重要指标

## 端到端时延
从源到目的地的总时延，即各个[[#节点时延]]的总和

- 细节
假设：
	1. 源与目的之间有$N - 1$台路由器
	2. 网络无拥塞，排队时延无穷小
	3. 基于上述符号系统
则：
	总时延：$d_{end-end}=N(d_proc+d_trans+d_prop)$
	其中：$d_trans=L/R$
	该公式是[[分组交换#存储转发传输]]的一般形式
当假设引入排队时延时：
	每个节点平均排队时延可能不同。需一般化处理（待处理）

- 使用Traceroute程序追踪端到端时延

## 端系统时延
- 共享媒体时，发送分组时有意的一些时延
- 媒体分组化时延